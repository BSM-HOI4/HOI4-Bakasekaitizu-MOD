

BSM_set_mine = {
	set_variable = {
		global.MD_gold_demand = 1
	}
	add_to_variable = {
		global.MD_gold_demand = threat
	}
	set_variable = {
		MD_cost = 0
	}
	set_variable = {
		MD_gold = 0
	}
	set_variable = {
		MD_juwel = 0
	}
	set_variable = {
		MD_gain = 0
	}
	every_owned_state = {
		if = {
			limit = {
				has_state_flag = Gold_Rush
			}
			add_to_variable = {
				amount_goid_mine = 1
			}
			multiply_variable = {
				amount_goid_mine = infrastructure_level
			}
			add_to_variable = {
				PREV.MD_gold = amount_goid_mine
			}
			add_to_variable = {
				PREV.MD_cost = amount_goid_mine
			}
		}
		if = {
			limit = {
				has_state_flag = Jewel_Rush
			}
			add_to_variable = {
				amount_juwel_mine = 1
			}
			multiply_variable = {
				amount_juwel_mine = infrastructure_level
			}
			add_to_variable = {
				PREV.MD_juwel = amount_juwel_mine
			}
			add_to_variable = {
				PREV.MD_cost = amount_goid_mine
			}
		}
	}
	divide_variable = {
		MD_cost = 30
	}
}

BSM_weekly_mine = {
	set_variable = {
		global.MD_gold_demand = 1
	}
	add_to_variable = {
		global.MD_gold_demand = threat
	}
	set_variable = {
		MD_cost = 0
	}
	set_variable = {
		MD_gold = 0
	}
	set_variable = {
		MD_juwel = 0
	}
	every_owned_state = {
		if = {
			limit = {
				has_state_flag = Gold_Rush
			}	
			add_to_variable = {
				PREV.MD_gold = amount_goid_mine
			}
			add_to_variable = {
				PREV.MD_cost = amount_goid_mine
			}
		}
		if = {
			limit = {
				has_state_flag = Jewel_Rush
			}
			add_to_variable = {
				PREV.MD_juwel = amount_juwel_mine
			}
			add_to_variable = {
				PREV.MD_cost = amount_goid_mine
			}
		}
		divide_variable = {
			MD_cost = 20
		}
		subtract_from_variable = {
			COUNTRY_e_c = MD_cost
		}
	}
}

BSM_MINE_EXPORT = {
	if = {
		limit = {
			has_idea = uncontrolled_exports
		}
		add_to_variable = {
			global.MD_gold_supply = MD_gold
		}
		add_to_variable = {
			global.MD_juwel_supply = MD_juwel
		}
		set_variable = {
			MD_gain_g = MD_gold
		}
		set_variable = {
			MD_gain_j = MD_juwel
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		add_to_variable = {
			MD_gain = MD_gain_g
		}
		add_to_variable = {
			MD_gain = MD_gain_j
		}
		multiply_variable = {
			MD_gain = global.MD_req
		}
		divide_variable = {
			MD_gain = 10
		}
	}else_if={
		limit = {
			has_idea = free_trade
		}
		add_to_variable = {
			global.MD_gold_supply = MD_gold
		}
		add_to_variable = {
			global.MD_juwel_supply = MD_juwel
		}
		set_temp_variable = {
			MD_gain_g = MD_gold
		}
		set_temp_variable = {
			MD_gain_j = MD_juwel
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		add_to_variable = {
			MD_gain = MD_gain_g
		}
		add_to_variable = {
			MD_gain = MD_gain_j
		}
		multiply_variable = {
			MD_gain = global.MD_req
		}
		divide_variable = {
			MD_gain = 5
		}
	}else_if={
		limit = {
			has_idea = export_focus
		}
		add_to_variable = {
			global.MD_gold_supply = MD_gold
		}
		add_to_variable = {
			global.MD_juwel_supply = MD_juwel
		}
		set_temp_variable = {
			MD_gain_g = MD_gold
		}
		set_temp_variable = {
			MD_gain_j = MD_juwel
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		add_to_variable = {
			MD_gain = MD_gain_g
		}
		add_to_variable = {
			MD_gain = MD_gain_j
		}
		multiply_variable = {
			MD_gain = global.MD_req
		}
		divide_variable = {
			MD_gain = 2.5
		}
	}else_if={
		limit = {
			has_idea = limited_exports
		}
		add_to_variable = {
			global.MD_gold_supply = MD_gold
		}
		add_to_variable = {
			global.MD_juwel_supply = MD_juwel
		}
		set_temp_variable = {
			MD_gain_g = MD_gold
		}
		set_temp_variable = {
			MD_gain_j = MD_juwel
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		add_to_variable = {
			MD_gain = MD_gain_g
		}
		add_to_variable = {
			MD_gain = MD_gain_j
		}
		multiply_variable = {
			MD_gain = global.MD_req
		}
		divide_variable = {
			MD_gain = 7.5
		}
	}else_if={
		limit = {
			has_idea = closed_economy
		}
		add_to_variable = {
			global.MD_gold_supply = MD_gold
		}
		add_to_variable = {
			global.MD_juwel_supply = MD_juwel
		}
		set_temp_variable = {
			MD_gain_g = MD_gold
		}
		set_temp_variable = {
			MD_gain_j = MD_juwel
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		multiply_variable = {
			MD_gain_g = global.MD_gold_demand
		}
		multiply_variable = {
			MD_gain_j = global.MD_juwel_demand
		}
		add_to_variable = {
			MD_gain = MD_gain_g
		}
		add_to_variable = {
			MD_gain = MD_gain_j
		}
		multiply_variable = {
			MD_gain = global.MD_req
		}
		divide_variable = {
			MD_gain = 10
		}
		add_to_variable = {
			COUNTRY_e_c = MD_gain
		}
	}
}